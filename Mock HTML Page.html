<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Clauses Generated</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #f72585;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f9c74f;
            --danger-color: #f94144;
            --border-radius: 8px;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }

        .dark-mode {
            --light-color: #121212;
            --dark-color: #f8f9fa;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--gradient);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .logo {
            font-size: 1.6rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
        }

        .card {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h1 {
            font-size: 1.8rem;
            margin-top: 15px;
        }

        .topic-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary-color);
        }

        .clause-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .clause-category {
            margin-bottom: 15px;
            border-left: 3px solid var(--primary-color);
            padding-left: 10px;
        }

        .clause-item {
            display: flex;
            align-items: flex-start;
            margin: 5px 0;
            padding: 6px;
            border-radius: 4px;
            background: rgba(67, 97, 238, 0.05);
            transition: var(--transition);
        }

        .clause-item:hover {
            background: rgba(67, 97, 238, 0.1);
        }

        .clause-item input[type="checkbox"] {
            margin-right: 8px;
            margin-top: 4px;
            cursor: pointer;
            transform: scale(1);
        }

        .clause-label {
            flex: 1;
            font-size: 0.9rem;
            cursor: pointer;
            line-height: 1.4;
        }

        .custom-verbiage {
            width: 100%;
            margin-top: 6px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            min-height: 70px;
            resize: vertical;
            background: rgba(255, 255, 255, 0.7);
        }

        .custom-verbiage:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        .template-section {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        select, input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
            font-size: 0.9rem;
            min-width: 160px;
        }

        button {
            padding: 8px 12px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            opacity: 0.9;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .section-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            user-select: none;
        }

        .section-toggle input[type="checkbox"] {
            transform: scale(1.1);
        }

        .addendum-section {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            resize: vertical;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.7);
        }

        .output-container {
            margin-top: 30px;
            display: none;
        }

        .output-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
            font-size: 0.9rem;
            border: 1px solid #e9ecef;
            line-height: 1.7;
            max-height: 500px;
            overflow-y: auto;
        }

        .output-section h3 {
            color: #2c3e50;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .output-section .clause {
            margin-left: 15px;
            margin-bottom: 8px;
        }

        .output-section .sub-clause {
            margin-left: 25px;
            margin-bottom: 6px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            padding: 10px 14px;
            border-radius: var(--border-radius);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            background-color: var(--success-color);
        }

        .toast.error {
            background-color: var(--danger-color);
        }

        .toast.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .progress-bar {
            height: 4px;
            width: 100%;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .topic-count {
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-left: 5px;
        }

        .hidden {
            display: none;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #6c757d;
            font-size: 0.85rem;
        }

        .clause-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 5px 0;
        }

        .clause-header h3 {
            margin: 0;
            font-size: 0.95rem;
        }

        .sub-clauses {
            padding-left: 15px;
            border-left: 2px solid #eee;
            margin: 6px 0;
        }

        .compact .clause-item {
            margin: 2px 0;
            padding: 4px;
        }

        .compact .clause-label {
            font-size: 0.85rem;
        }

        .view-options {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .view-option {
            padding: 4px 8px;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .view-option.active {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-scale-balanced"></i>
            <span>Contract Clauses Generation</span>
        </div>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
    </header>

    <div class="container">
        <h1>Contract Clauses Generation <span class="topic-count" id="selectedCount">0</span></h1>
        <p>Generate legal clauses for your contracts with AI assistance. Select clauses, customize verbiage, and create professional contracts.</p>

        <div class="template-section">
            <select id="templateSelect">
                <option value="">Load a saved template...</option>
                <option value="standard">Standard Contract</option>
                <option value="nda">NDA Agreement</option>
                <option value="service">Service Agreement</option>
            </select>
            <button id="saveTemplateBtn" class="btn-secondary">
                <i class="fas fa-save"></i> Save Template
            </button>
            <button id="resetBtn" class="btn-danger">
                <i class="fas fa-trash"></i> Reset Form
            </button>
        </div>

        <div class="main-content">
            <div class="card">
                <div class="topic-controls">
                    <h2><i class="fas fa-list-check"></i> Contract Clauses</h2>
                    <div>
                        <input type="checkbox" id="selectAll">
                        <label for="selectAll">Select All</label>
                    </div>
                </div>
                
                <div class="view-options">
                    <div class="view-option active" id="viewNormal">Normal</div>
                    <div class="view-option" id="viewCompact">Compact</div>
                </div>
                
                <div class="clause-container" id="clauseContainer">
                    <!-- Clauses will be populated here -->
                </div>
            </div>

            <div class="card">
                <div class="section-toggle">
                    <input type="checkbox" id="addendumToggle" checked>
                    <label for="addendumToggle"><h2><i class="fas fa-file-plus"></i> Addendum / Custom Provisions</h2></label>
                </div>
                <div class="content">
                    <p>Add any supplementary clauses or custom provisions not covered by the topics above:</p>
                    <textarea id="addendum" class="addendum-section" placeholder="Enter custom provisions here..."></textarea>
                </div>
            </div>

            <div class="action-buttons">
                <button id="generateBtn" class="btn-primary">
                    <i class="fas fa-bolt"></i> Generate Contract
                </button>
            </div>

            <div id="outputContainer" class="output-container">
                <div class="card">
                    <h2><i class="fas fa-file-contract"></i> Generated Output</h2>
                    <div class="progress-bar">
                        <div class="progress" id="generateProgress"></div>
                    </div>
                    <div id="output" class="output-section">
                        Your generated legal clauses will appear here.
                    </div>
                    
                    <div class="action-buttons">
                        <button id="copyBtn" class="btn-secondary">
                            <i class="fas fa-copy"></i> Copy to Clipboard
                        </button>
                        <button id="exportBtn" class="btn-success">
                            <i class="fas fa-download"></i> Export as DOCX
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer">
        <!-- Toasts will be added here dynamically -->
    </div>

    <footer>
        <p>Contract Clauses Generator v2.0 | © 2025 All rights reserved</p>
    </footer>

    <script>
        // Legal clauses with numbering
        const legalClauses = [
            {
                id: "1",
                title: "Introduction",
                subClauses: [
                    { id: "1.1", title: "Parties Involved" },
                    { id: "1.2", title: "Purpose of Agreement" },
                    { id: "1.3", title: "Definitions" }
                ]
            },
            {
                id: "2",
                title: "Scope of Work",
                subClauses: [
                    { id: "2.1", title: "Project Description" },
                    { id: "2.2", title: "Deliverables" },
                    { id: "2.3", title: "Timeline and Milestones" },
                    { id: "2.4", title: "Changes to Scope" }
                ]
            },
            {
                id: "3",
                title: "Responsibilities",
                subClauses: [
                    { id: "3.1", title: "Responsibilities of the Contractor" },
                    { id: "3.2", title: "Responsibilities of the Client" },
                    { id: "3.3", title: "Communication Protocols" }
                ]
            },
            {
                id: "4",
                title: "Compensation",
                subClauses: [
                    { id: "4.1", title: "Payment Terms" },
                    { id: "4.2", title: "Expenses" },
                    { id: "4.3", title: "Invoicing Process" }
                ]
            },
            {
                id: "5",
                title: "Performance Standards",
                subClauses: [
                    { id: "5.1", title: "Quality Assurance" },
                    { id: "5.2", title: "Performance Metrics" },
                    { id: "5.3", title: "Review and Acceptance Process" }
                ]
            },
            {
                id: "6",
                title: "Confidentiality",
                subClauses: [
                    { id: "6.1", title: "Definition of Confidential Information" },
                    { id: "6.2", title: "Obligations of Confidentiality" },
                    { id: "6.3", title: "Exceptions" }
                ]
            },
            {
                id: "7",
                title: "Intellectual Property",
                subClauses: [
                    { id: "7.1", title: "Ownership of Work Product" },
                    { id: "7.2", title: "Licensing Rights" },
                    { id: "7.3", title: "Use of Pre-existing Materials" }
                ]
            },
            {
                id: "8",
                title: "Term and Termination",
                subClauses: [
                    { id: "8.1", title: "Contract Duration" },
                    { id: "8.2", title: "Termination for Cause" },
                    { id: "8.3", title: "Termination for Convenience" }
                ]
            },
            {
                id: "9",
                title: "Liability and Indemnification",
                subClauses: [
                    { id: "9.1", title: "Limitation of Liability" },
                    { id: "9.2", title: "Indemnification Obligations" }
                ]
            },
            {
                id: "10",
                title: "Dispute Resolution",
                subClauses: [
                    { id: "10.1", title: "Governing Law" },
                    { id: "10.2", title: "Mediation and Arbitration" },
                    { id: "10.3", title: "Jurisdiction" }
                ]
            },
            {
                id: "11",
                title: "Miscellaneous",
                subClauses: [
                    { id: "11.1", title: "Force Majeure" },
                    { id: "11.2", title: "Amendments" },
                    { id: "11.3", title: "Severability" },
                    { id: "11.4", title: "Entire Agreement" }
                ]
            },
            {
                id: "12",
                title: "Signatures",
                subClauses: [
                    { id: "12.1", title: "Execution of Agreement" },
                    { id: "12.2", title: "Witnesses (if applicable)" }
                ]
            }
        ];

        // Sample AI-generated verbiage for each clause
        const aiVerbiage = {
            "1.1": "This Agreement is made and entered into as of [Date], by and between [Party A Name], with a principal place of business at [Address] (hereinafter referred to as 'Party A'), and [Party B Name], with a principal place of business at [Address] (hereinafter referred to as 'Party B').",
            "1.2": "The purpose of this Agreement is to set forth the terms and conditions under which [Party A] will provide [services/goods] to [Party B], and [Party B] will compensate [Party A] for such [services/goods].",
            "1.3": "For the purposes of this Agreement, the following terms shall have the meanings set forth below: (a) 'Confidential Information' means...; (b) 'Effective Date' means...; (c) 'Work Product' means...",
            "2.1": "Party A shall provide the following services: [detailed description of services]. All services shall be performed in a professional and workmanlike manner, consistent with generally accepted industry standards.",
            "2.2": "Party A shall deliver the following items to Party B: [list of deliverables]. All deliverables shall be submitted in [format] and shall meet the specifications outlined in Exhibit A.",
            "2.3": "The project shall be completed according to the following timeline: [list of milestones with dates]. Time is of the essence for this Agreement.",
            "2.4": "Any changes to the scope of work must be agreed upon in writing by both parties. If the scope change affects the project timeline or compensation, the parties shall negotiate in good faith to adjust these terms accordingly.",
            "3.1": "Party A shall perform the services described in this Agreement in accordance with all applicable laws and regulations, and shall take all reasonable steps to ensure the quality and timeliness of such services.",
            "3.2": "Party B shall provide Party A with all necessary information and resources to allow Party A to perform the services under this Agreement. Party B agrees to cooperate fully with Party A to facilitate the completion of the services.",
            "3.3": "Both parties agree to establish a communication protocol for regular updates and meetings. Party A shall report on progress at [frequency], and Party B will provide feedback within [timeframe].",
            "4.1": "Payment for services rendered under this Agreement shall be made according to the following schedule: [payment terms]. Payments shall be made within [number] days of receipt of invoice.",
            "4.2": "Party B shall reimburse Party A for any pre-approved expenses incurred in the course of providing services, subject to the submission of appropriate documentation and receipts.",
            "4.3": "Party A shall submit invoices to Party B on a monthly basis (or as otherwise agreed), detailing the services performed and any reimbursable expenses. Party B shall pay each invoice in full within [payment period].",
            "5.1": "Party A shall adhere to industry standards and ensure that all deliverables meet the agreed-upon quality requirements. In the event of a failure to meet these standards, Party A shall rectify any deficiencies at no additional charge to Party B.",
            "5.2": "The parties agree to mutually define performance metrics for evaluating the success of the services. These metrics will be used to assess the quality and timeliness of deliverables, as well as the overall project outcome.",
            "5.3": "Upon completion of each deliverable, Party B shall have [number] days to review and either approve or request revisions. If no feedback is provided within this period, the deliverable will be considered accepted.",
            "6.1": "'Confidential Information' refers to all proprietary or confidential data, whether written or oral, disclosed by either party to the other, including but not limited to business plans, financial information, client lists, and technical data.",
            "6.2": "Each party agrees to maintain the confidentiality of all Confidential Information disclosed to it and to use such information solely for the purpose of performing its obligations under this Agreement. This obligation shall survive termination of this Agreement.",
            "6.3": "The confidentiality obligations set forth in this section shall not apply to information that (a) was already publicly available at the time of disclosure; (b) was disclosed with the written consent of the disclosing party; or (c) is required to be disclosed by law.",
            "7.1": "Unless otherwise agreed, Party A shall retain ownership of all Work Product produced in connection with this Agreement. This includes any intellectual property rights therein, such as copyrights, trademarks, and patents.",
            "7.2": "Party A grants Party B a non-exclusive, non-transferable license to use the Work Product solely for the purposes outlined in this Agreement. Party B shall not sublicense, transfer, or modify the Work Product without prior written consent from Party A.",
            "7.3": "Any pre-existing intellectual property owned by either party shall remain the exclusive property of the owning party. Both parties agree not to infringe upon the other party's pre-existing intellectual property rights during the course of this Agreement.",
            "8.1": "The term of this Agreement shall commence on the Effective Date and continue until the completion of the services or until terminated in accordance with the provisions of this Agreement.",
            "8.2": "Either party may terminate this Agreement for cause, including but not limited to material breach of any provision of this Agreement, by providing written notice to the other party. The breach must remain uncured for [number] days after notice is given.",
            "8.3": "Either party may terminate this Agreement for convenience by providing [number] days’ written notice to the other party. Upon termination, Party A shall be entitled to compensation for services rendered up to the effective date of termination.",
            "9.1": "In no event shall either party be liable to the other for any consequential, incidental, or punitive damages arising out of this Agreement, including but not limited to lost profits or business opportunities, regardless of the cause of action.",
            "9.2": "Each party agrees to indemnify and hold harmless the other party from any third-party claims, liabilities, or expenses arising from its own acts or omissions in connection with this Agreement, except where such acts or omissions are due to the other party's negligence or misconduct.",
            "10.1": "This Agreement shall be governed by and construed in accordance with the laws of [Jurisdiction]. Any disputes arising under this Agreement shall be subject to the exclusive jurisdiction of the courts of [Jurisdiction].",
            "10.2": "In the event of any dispute or claim arising out of or relating to this Agreement, the parties agree to attempt to resolve the dispute through mediation before resorting to arbitration or litigation. Mediation shall be conducted in [location], and each party shall bear its own costs.",
            "10.3": "Any legal action or proceeding under this Agreement shall be brought exclusively in the courts located in [Jurisdiction], and each party irrevocably consents to the jurisdiction and venue of such courts.",
            "11.1": "Neither party shall be liable for any delay or failure in performance under this Agreement due to causes beyond its reasonable control, including but not limited to acts of God, war, terrorism, labor disputes, or government regulations.",
            "11.2": "This Agreement may be amended only in writing, signed by both parties. Any amendment or modification shall be deemed effective upon execution by both parties.",
            "11.3": "If any provision of this Agreement is found to be invalid or unenforceable, the remaining provisions shall continue in full force and effect, and the invalid provision shall be replaced by a valid provision that closely reflects the intent of the original provision.",
            "11.4": "This Agreement constitutes the entire understanding between the parties with respect to its subject matter and supersedes all prior or contemporaneous agreements, understandings, and negotiations, whether written or oral.",
            "12.1": "This Agreement is executed and binding upon the parties when signed by their duly authorized representatives. Each party affirms that it has the full power and authority to enter into this Agreement.",
            "12.2": "The signatures of the parties below shall serve as their acknowledgment and acceptance of all terms and conditions contained in this Agreement, effective as of the date of the last signature."
        };

        // State management
        let state = {
            selectedClauses: {},
            customVerbiage: {},
            addendum: "",
            generatedOutput: "",
            templates: JSON.parse(localStorage.getItem('legalTemplates')) || {},
            darkMode: localStorage.getItem('darkMode') === 'true',
            renumberMap: {}
        };

        // DOM elements
        const clauseContainer = document.getElementById('clauseContainer');
        const addendumElement = document.getElementById('addendum');
        const output = document.getElementById('output');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const exportBtn = document.getElementById('exportBtn');
        const templateSelect = document.getElementById('templateSelect');
        const saveTemplateBtn = document.getElementById('saveTemplateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const selectAll = document.getElementById('selectAll');
        const addendumToggle = document.getElementById('addendumToggle');
        const themeToggle = document.getElementById('themeToggle');
        const toastContainer = document.getElementById('toastContainer');
        const generateProgress = document.getElementById('generateProgress');
        const selectedCount = document.getElementById('selectedCount');
        const outputContainer = document.getElementById('outputContainer');
        const viewNormal = document.getElementById('viewNormal');
        const viewCompact = document.getElementById('viewCompact');

        // Initialize the page
        function init() {
            renderClauses();
            setupEventListeners();
            updateSelectedCount();
            
            // Apply dark mode if enabled
            if (state.darkMode) {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        // Render legal clauses with numbering
        function renderClauses() {
            legalClauses.forEach(clause => {
                const clauseCategory = document.createElement('div');
                clauseCategory.className = 'clause-category';
                
                const clauseHeader = document.createElement('div');
                clauseHeader.className = 'clause-header';
                clauseHeader.innerHTML = `
                    <h3>${clause.id}. ${clause.title}</h3>
                    <i class="fas fa-chevron-down"></i>
                `;
                
                const subClausesContainer = document.createElement('div');
                subClausesContainer.className = 'sub-clauses';
                
                clause.subClauses.forEach(subClause => {
                    const clauseItem = document.createElement('div');
                    clauseItem.className = 'clause-item';
                    clauseItem.innerHTML = `
                        <input type="checkbox" id="clause-${subClause.id}" data-id="${subClause.id}">
                        <div class="clause-content">
                            <label class="clause-label" for="clause-${subClause.id}">
                                <strong>${subClause.id}</strong> ${subClause.title}
                            </label>
                            <textarea class="custom-verbiage hidden" data-id="${subClause.id}" 
                                      placeholder="Enter custom verbiage or leave blank for AI-generated content"></textarea>
                        </div>
                    `;
                    subClausesContainer.appendChild(clauseItem);
                });
                
                clauseCategory.appendChild(clauseHeader);
                clauseCategory.appendChild(subClausesContainer);
                clauseContainer.appendChild(clauseCategory);
                
                // Add toggle functionality for clause categories
                clauseHeader.addEventListener('click', () => {
                    const icon = clauseHeader.querySelector('i');
                    if (subClausesContainer.style.display === 'none') {
                        subClausesContainer.style.display = 'block';
                        icon.className = 'fas fa-chevron-down';
                    } else {
                        subClausesContainer.style.display = 'none';
                        icon.className = 'fas fa-chevron-right';
                    }
                });
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Clause selection
            clauseContainer.addEventListener('change', (e) => {
                if (e.target.type === 'checkbox') {
                    const id = e.target.dataset.id;
                    const textarea = document.querySelector(`.custom-verbiage[data-id="${id}"]`);
                    
                    if (e.target.checked) {
                        textarea.classList.remove('hidden');
                        state.selectedClauses[id] = true;
                    } else {
                        textarea.classList.add('hidden');
                        delete state.selectedClauses[id];
                        delete state.customVerbiage[id];
                    }
                    updateSelectedCount();
                    updateSelectAllCheckbox();
                }
            });

            // Custom verbiage input
            clauseContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('custom-verbiage')) {
                    const id = e.target.dataset.id;
                    state.customVerbiage[id] = e.target.value;
                }
            });

            // Addendum input
            addendumElement.addEventListener('input', (e) => {
                state.addendum = e.target.value;
            });

            // Generate button
            generateBtn.addEventListener('click', generateOutput);

            // Copy button
            copyBtn.addEventListener('click', copyToClipboard);

            // Export button
            exportBtn.addEventListener('click', exportAsDOCX);

            // Save template button
            saveTemplateBtn.addEventListener('click', saveTemplate);

            // Reset button
            resetBtn.addEventListener('click', resetForm);

            // Select all checkbox
            selectAll.addEventListener('change', (e) => {
                const checkboxes = document.querySelectorAll('.clause-item input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = e.target.checked;
                    const id = checkbox.dataset.id;
                    const textarea = document.querySelector(`.custom-verbiage[data-id="${id}"]`);
                    
                    if (e.target.checked) {
                        textarea.classList.remove('hidden');
                        state.selectedClauses[id] = true;
                    } else {
                        textarea.classList.add('hidden');
                        delete state.selectedClauses[id];
                        delete state.customVerbiage[id];
                    }
                });
                updateSelectedCount();
            });

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // View options
            viewNormal.addEventListener('click', () => {
                viewNormal.classList.add('active');
                viewCompact.classList.remove('active');
                clauseContainer.classList.remove('compact');
            });
            
            viewCompact.addEventListener('click', () => {
                viewCompact.classList.add('active');
                viewNormal.classList.remove('active');
                clauseContainer.classList.add('compact');
            });
        }

        // Update selected count
        function updateSelectedCount() {
            const count = Object.keys(state.selectedClauses).length;
            selectedCount.textContent = count;
        }

        // Update Select All checkbox state
        function updateSelectAllCheckbox() {
            const checkboxes = document.querySelectorAll('.clause-item input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            const someChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);
            
            selectAll.checked = allChecked;
            selectAll.indeterminate = someChecked && !allChecked;
        }

        // Create renumbering map for selected clauses
        function createRenumberMap() {
            state.renumberMap = {};
            
            legalClauses.forEach(clause => {
                let mainCount = 0;
                let selectedSubClauses = [];
                
                // Find all selected subclauses for this main clause
                clause.subClauses.forEach(subClause => {
                    if (state.selectedClauses[subClause.id]) {
                        selectedSubClauses.push(subClause.id);
                    }
                });
                
                // Create mapping for selected subclauses
                if (selectedSubClauses.length > 0) {
                    selectedSubClauses.forEach((oldId, index) => {
                        const newId = `${clause.id}.${index + 1}`;
                        state.renumberMap[oldId] = newId;
                    });
                }
            });
        }

        // Generate the output
        async function generateOutput() {
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-cog fa-spin"></i> Generating...';
            
            // Create renumbering map
            createRenumberMap();
            
            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                generateProgress.style.width = `${progress}%`;
                if (progress >= 100) clearInterval(progressInterval);
            }, 100);
            
            try {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                let outputText = "CONTRACT AGREEMENT\n\n";
                outputText += "This Agreement is made and entered into as of [Date], by and between [Party A] and [Party B].\n\n";
                
                // Track which main clauses have selected subclauses
                const mainClausesWithSelections = new Set();
                
                // Add selected clauses with custom or AI-generated verbiage
                legalClauses.forEach(clause => {
                    let hasSelectedSubClause = false;
                    let clauseContent = "";
                    
                    clause.subClauses.forEach(subClause => {
                        if (state.selectedClauses[subClause.id]) {
                            hasSelectedSubClause = true;
                            mainClausesWithSelections.add(clause.id);
                            
                            const newId = state.renumberMap[subClause.id];
                            clauseContent += `<div class="sub-clause"><strong>${newId}</strong> ${subClause.title}\n`;
                            
                            if (state.customVerbiage[subClause.id] && state.customVerbiage[subClause.id].trim() !== "") {
                                clauseContent += state.customVerbiage[subClause.id] + "\n</div>";
                            } else {
                                clauseContent += (aiVerbiage[subClause.id] || `Standard legal verbiage for ${subClause.id} would appear here.`) + "\n</div>";
                            }
                        }
                    });
                    
                    if (hasSelectedSubClause) {
                        outputText += `<h3>${clause.id}. ${clause.title}</h3>\n`;
                        outputText += clauseContent + "\n";
                    }
                });
                
                // Add addendum if provided
                if (state.addendum.trim() !== "") {
                    outputText += "<h3>ADDENDUM</h3>\n";
                    outputText += state.addendum + "\n";
                }
                
                outputText += "\nIN WITNESS WHEREOF, the parties have executed this Agreement as of the date first above written.\n\n";
                outputText += "[Party A Signature] ___________________________\n";
                outputText += "[Party B Signature] ___________________________\n";
                
                state.generatedOutput = outputText;
                output.innerHTML = outputText;
                
                // Show output container
                outputContainer.style.display = 'block';
                
                // Scroll to output
                outputContainer.scrollIntoView({ behavior: 'smooth' });
                
                showToast('Legal clauses generated successfully!', 'success');
            } catch (error) {
                showToast('Error generating legal clauses. Please try again.', 'error');
                console.error('Generation error:', error);
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-bolt"></i> Generate Contract';
            }
        }

        // Copy to clipboard
        function copyToClipboard() {
            // Create a temporary textarea to copy from
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = output.innerText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            
            try {
                document.execCommand('copy');
                showToast('Copied to clipboard!', 'success');
            } catch (err) {
                showToast('Failed to copy to clipboard.', 'error');
                console.error('Copy error:', err);
            } finally {
                document.body.removeChild(tempTextArea);
            }
        }

        // Export as DOCX
        function exportAsDOCX() {
            showToast('Document exported successfully!', 'success');
            // In a real implementation, this would use a library like docx.js
        }

        // Save template
        function saveTemplate() {
            const templateName = prompt('Enter a name for this template:');
            if (!templateName) return;
            
            const templateData = {
                selectedClauses: state.selectedClauses,
                customVerbiage: state.customVerbiage
            };
            
            state.templates[templateName] = templateData;
            localStorage.setItem('legalTemplates', JSON.stringify(state.templates));
            
            showToast(`Template "${templateName}" saved successfully!`, 'success');
        }

        // Reset form
        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All your changes will be lost.')) {
                // Reset checkboxes and textareas
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                    const id = checkbox.dataset.id;
                    if (id) {
                        const textarea = document.querySelector(`.custom-verbiage[data-id="${id}"]`);
                        textarea.classList.add('hidden');
                        textarea.value = "";
                    }
                });
                
                // Reset state
                state.selectedClauses = {};
                state.customVerbiage = {};
                state.addendum = "";
                state.generatedOutput = "";
                
                // Reset UI
                addendumElement.value = "";
                output.innerHTML = "Your generated legal clauses will appear here.";
                generateProgress.style.width = '0%';
                updateSelectedCount();
                updateSelectAllCheckbox();
                
                // Hide output container
                outputContainer.style.display = 'none';
                
                showToast('Form reset successfully', 'success');
            }
        }

        // Toggle theme
        function toggleTheme() {
            state.darkMode = !state.darkMode;
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', state.darkMode);
            
            if (state.darkMode) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                showToast('Dark mode enabled', 'success');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                showToast('Light mode enabled', 'success');
            }
        }

        // Show toast message
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>